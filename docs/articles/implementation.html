<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How interactive ComplexHeatmap is implemented • InteractiveComplexHeatmap</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How interactive ComplexHeatmap is implemented">
<meta property="og:description" content="InteractiveComplexHeatmap">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">InteractiveComplexHeatmap</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.99.0.1016</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/InteractiveComplexHeatmap.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/implementation.html">How interactive ComplexHeatmap is implemented</a>
    </li>
    <li>
      <a href="../articles/shiny_dev.html">Functions for Shiny app development</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jokergoo/InteractiveComplexHeatmap/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="implementation_files/header-attrs-2.5/header-attrs.js"></script><script src="implementation_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="implementation_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="implementation_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>How interactive ComplexHeatmap is implemented</h1>
                        <h4 class="author">Zuguang Gu ( <a href="mailto:z.gu@dkfz.de" class="email">z.gu@dkfz.de</a> )</h4>
            
            <h4 class="date">2020-12-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/jokergoo/InteractiveComplexHeatmap/blob/master/vignettes/implementation.Rmd"><code>vignettes/implementation.Rmd</code></a></small>
      <div class="hidden name"><code>implementation.Rmd</code></div>

    </div>

    
    
<style>
p {
    margin: 1em 0;
}
</style>
<p>Heatmaps are mainly for visualizing common patterns that are shared by groups of rows and columns. After the patterns have been observed, the next step is to extract the corresponding groups of rows and columns from the heatmap, which requires interactivity on the heatmaps. The <strong>ComplexHeatmap</strong> package is well known for generating <strong>static heatmaps</strong> (a single heatmap or a list of heatmaps, possible with complex annotations). Here the package <strong>InteractiveComplexHeatmap</strong> brings interactivity to <strong>ComplexHeatmap</strong>. The new functionalities allow users to capture sub-heatmaps by clicking or selecting areas from heatmaps.</p>
<p>Unlike other packages which support interactive heatmaps based on JavaScript, <em>e.g.</em>, <strong>iheatmapr</strong>, <strong>heatmaply</strong> and <strong>d3heatmap</strong>, <strong>InteractiveComplexHeatmap</strong> has a special way to capture the positions that users selected and to extract the corresponding values from the matrices. In this vignette, I will explain in details how I implement the interactivity based on <strong>ComplexHeatmap</strong>.</p>
<p>To demonstrate it, I first generate a list of two heatmaps and apply <em>k</em>-means clustering on the numeric heatmap.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/InteractiveComplexHeatmap">InteractiveComplexHeatmap</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">mat1</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mat1</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat1</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>
<span class="va">mat2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">mat2</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">mat2</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>

<span class="va">ht_list</span> <span class="op">=</span> <span class="fu">Heatmap</span><span class="op">(</span><span class="va">mat1</span>, name <span class="op">=</span> <span class="st">"mat_a"</span>, row_km <span class="op">=</span> <span class="fl">2</span>, column_km <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">Heatmap</span><span class="op">(</span><span class="va">mat2</span>, name <span class="op">=</span> <span class="st">"mat_b"</span><span class="op">)</span></code></pre></div>
<p><strong>InteractiveComplexHeatmap</strong> implements two types of interactivity:</p>
<ol style="list-style-type: decimal">
<li>on the interactive graphics device,</li>
<li>on a Shiny app.</li>
</ol>
<p>The interactivity on the interactive graphics device is the basis of the interactivity of the Shiny app, so in the following, I will first introduce how the interactivity is implemneted with the interactive graphic device.</p>
<div id="on-the-interactive-graphics-device" class="section level2">
<h2 class="hasAnchor">
<a href="#on-the-interactive-graphics-device" class="anchor"></a>On the interactive graphics device</h2>
<p>Here the “interactive graphics device” is the window that is opened for generating plots in your R session, or the figure panel in Rstudio IDE.</p>
<p>I will first explain how <strong>InteractiveComplexHeatmap</strong> captures the positions that user clicked on the device and how it is associated to the values in the matrix.</p>
<p>When user clicks on the device, the physical locations relative in the device are captured by <code><a href="https://rdrr.io/r/grid/grid.locator.html">grid::grid.locator()</a></code>. The physical locations of the heatmaps (more precisely, the heatmap slices) can also be captured by <code><a href="https://rdrr.io/r/grid/deviceLoc.html">grid::deviceLoc()</a></code>. With knowing the exact positions of the selected points and the heatmaps, it is possible to tell which heatmap the selected points are in. Furthermore, by calculating the relative distance of the selected points in that heatmap, it is also possible to know which rows and columns the selected points correspond to.</p>
<p>For associating user’s points and the heatmaps, we first need to calculate the positions of all heatmaps. There is a helper function <code><a href="../reference/ht_pos_on_device.html">ht_pos_on_device()</a></code> that does this job.</p>
<p>Before executing <code><a href="../reference/ht_pos_on_device.html">ht_pos_on_device()</a></code>, the heatmap should be drawn on the device and the layout of heatmaps should have been done. Thus, the heatmap object <code>ht_list</code> should be updated explictly by the <code>draw()</code> function.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ht_list</span> <span class="op">=</span> <span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span><span class="op">)</span>
<span class="va">pos</span> <span class="op">=</span> <span class="fu"><a href="../reference/ht_pos_on_device.html">ht_pos_on_device</a></span><span class="op">(</span><span class="va">ht_list</span><span class="op">)</span></code></pre></div>
<p><img src="implementation_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"></p>
<p>The returned object <code>pos</code> is a <code>DataFrame</code> object that contains the positions of all heatmap slices. A <code>DataFrame</code> object (the <code>DataFrame</code> class is defined in <a href="https://bioconductor.org/packages/release/bioc/html/S4Vectors.html"><strong>S4Vectors</strong> package</a>) is bacially very similar to a data frame, but it can store more complex data types, such as the <code>simpleUnit</code> vectors (generated by <code><a href="https://rdrr.io/r/grid/unit.html">grid::unit()</a></code>).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pos</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 8 columns
##       heatmap                  slice row_slice column_slice
##   &lt;character&gt;            &lt;character&gt; &lt;integer&gt;    &lt;integer&gt;
## 1       mat_a mat_a_heatmap_body_1_1         1            1
## 2       mat_a mat_a_heatmap_body_1_2         1            2
## 3       mat_a mat_a_heatmap_body_2_1         2            1
## 4       mat_a mat_a_heatmap_body_2_2         2            2
## 5       mat_b mat_b_heatmap_body_1_1         1            1
## 6       mat_b mat_b_heatmap_body_2_1         2            1
##                    x_min                  x_max                   y_min
##             &lt;simpleUnit&gt;           &lt;simpleUnit&gt;            &lt;simpleUnit&gt;
## 1 0.73225949496039inches 1.77967164410527inches  1.03131909059313inches
## 2 1.81904172284543inches 2.86645387199032inches  1.03131909059313inches
## 3 0.73225949496039inches 1.77967164410527inches 0.432843658241349inches
## 4 1.81904172284543inches 2.86645387199032inches 0.432843658241349inches
## 5 2.94519402947063inches 5.07938840650056inches  1.03131909059313inches
## 6 2.94519402947063inches 5.07938840650056inches 0.432843658241349inches
##                    y_max
##             &lt;simpleUnit&gt;
## 1 3.26774050503961inches
## 2 3.26774050503961inches
## 3 0.99194901185297inches
## 4 0.99194901185297inches
## 5 3.26774050503961inches
## 6 0.99194901185297inches</code></pre>
<p>We can confirm whether the positions are correctly captured by the following code. In the next figure, black rectangles correspond to the heatmap slices and the dashed rectangle corresponds to the border of the whole image.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># If you try the code in your interactive R session, you need the following </span>
<span class="co"># two lines to open a new device with the same size as the current one.</span>
<span class="co"># ds = dev.size()</span>
<span class="co"># dev.new(width = ds[1], height = ds[2])</span>
<span class="fu">grid.newpage</span><span class="op">(</span><span class="op">)</span>
<span class="fu">grid.rect</span><span class="op">(</span>gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">pos</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">x_min</span> <span class="op">=</span> <span class="va">pos</span><span class="op">[</span><span class="va">i</span>, <span class="st">"x_min"</span><span class="op">]</span>
    <span class="va">x_max</span> <span class="op">=</span> <span class="va">pos</span><span class="op">[</span><span class="va">i</span>, <span class="st">"x_max"</span><span class="op">]</span>
    <span class="va">y_min</span> <span class="op">=</span> <span class="va">pos</span><span class="op">[</span><span class="va">i</span>, <span class="st">"y_min"</span><span class="op">]</span>
    <span class="va">y_max</span> <span class="op">=</span> <span class="va">pos</span><span class="op">[</span><span class="va">i</span>, <span class="st">"y_max"</span><span class="op">]</span>
    <span class="fu">pushViewport</span><span class="op">(</span><span class="fu">viewport</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_min</span>, y <span class="op">=</span> <span class="va">y_min</span>, name <span class="op">=</span> <span class="va">pos</span><span class="op">[</span><span class="va">i</span>, <span class="st">"slice"</span><span class="op">]</span>,
        width <span class="op">=</span> <span class="va">x_max</span> <span class="op">-</span> <span class="va">x_min</span>, height <span class="op">=</span> <span class="va">y_max</span> <span class="op">-</span> <span class="va">y_min</span>,
        just <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="fu">grid.rect</span><span class="op">(</span><span class="op">)</span>
    <span class="fu">upViewport</span><span class="op">(</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p><img src="implementation_files/figure-html/unnamed-chunk-5-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Yes, the positions of all heatmap slices are correct!</p>
<p>Since now we know the location of the point that user clicked (by <code><a href="https://rdrr.io/r/grid/grid.locator.html">grid::grid.locator()</a></code>) and the positions of all heatmap slices, it is possible to calculate which row and which column in the original matrix user’s point corresponds to.</p>
<p>In the next figure, the blue point with the coordinate <span class="math inline">\((a, b)\)</span> is clicked by user. The heatmap slice where user clicked into has range <span class="math inline">\((x_1,x_2)\)</span> on x direction and range <span class="math inline">\((y_1, y_2)\)</span> on y direction. There are <span class="math inline">\(n_r\)</span> rows (<span class="math inline">\(n_r =8\)</span>) and <span class="math inline">\(n_c\)</span> columns (<span class="math inline">\(n_c = 5\)</span>) in this heatmap slice and they are marked by dashed lines. Note all the coordinate values (<em>i.e.</em>, <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, <span class="math inline">\(x_1\)</span>, <span class="math inline">\(y_1\)</span>, <span class="math inline">\(x_2\)</span> and <span class="math inline">\(y_2\)</span>) are measured as the physical positions in the graphics device.</p>
<p><img src="implementation_files/figure-html/unnamed-chunk-6-1.png" width="576" style="display: block; margin: auto;"></p>
<p>In this heatmap slice, the row index <span class="math inline">\(i_r\)</span> and column index <span class="math inline">\(i_c\)</span> of the cell where the point is in can be calculated as (assume the left bottom corresponds to the index of 1 for both rows and columns):</p>
<p><span class="math display">\[ i_c = \lceil \frac{a - x_1}{x_2 - x_1} \cdot n_c \rceil \]</span> <span class="math display">\[ i_r = \lceil \frac{b - y_1}{y_2 - y_1} \cdot n_r \rceil \]</span></p>
<p>where the symbol <span class="math inline">\(\lceil x \rceil\)</span> means the ceiling of the numeric value <span class="math inline">\(x\)</span>. In <strong>ComplexHeatmap</strong>, the row with index 1 is always put on the top of the heatmap, then <span class="math inline">\(i_r\)</span> should be calculated as:</p>
<p><span class="math display">\[ i_r = n_r - \lceil \frac{b - y_1}{y_2 - y_1} \cdot n_r \rceil + 1 \]</span></p>
<p>The subset of row and column indices of the original matrix that belongs to the selected heatmap slice is already stored in <code>ht_list</code> object (they can be retrieved by <code>row_order()</code> and <code>column_order()</code> function), thus, we can obtain the row and column index of the original matrix that corresponds to user’s point easily with <span class="math inline">\(i_r\)</span> and <span class="math inline">\(i_c\)</span>.</p>
<p>Denote the matrix for the complete heatmap (without slicing) as <span class="math inline">\(M\)</span>, and denote the subset of row and column indices in that heatmap as <span class="math inline">\(o_r\)</span>, <span class="math inline">\(o_c\)</span>. Note, <span class="math inline">\(o_r\)</span> and <span class="math inline">\(o_c\)</span> can be reordered due to clustering. Then the row and column indices (<span class="math inline">\(j_r\)</span> and <span class="math inline">\(j_c\)</span>) for the selected point in <span class="math inline">\(M\)</span> are</p>
<p><span class="math display">\[j_r = o_{r, i_r}\]</span> <span class="math display">\[j_c = o_{c, i_c}\]</span></p>
<p>And the corresponding value in <span class="math inline">\(M\)</span> is <span class="math inline">\(M_{j_r, j_c}\)</span>.</p>
<p><strong>InteractiveComplexHeatmap</strong> has two functions <code><a href="../reference/selectPosition.html">selectPosition()</a></code> and <code><a href="../reference/selectArea.html">selectArea()</a></code> which allows users to pick single positions or select areas from the heatmaps. Under the interactive graphics device, users do not need to run <code><a href="../reference/ht_pos_on_device.html">ht_pos_on_device()</a></code> explicitly. The positions of heatmaps are automatically calculated, cached and reused if the heatmaps are the same and the device has not changed its size. If users changed the device size, <code><a href="../reference/ht_pos_on_device.html">ht_pos_on_device()</a></code> will be automatically re-executed.</p>
<p>The next image shows an example of using <code><a href="../reference/selectPosition.html">selectPosition()</a></code>.</p>
<p>
<img width="100%" style="border:1px solid grey;padding: 4px;" src="https://user-images.githubusercontent.com/449218/102546377-d7e16d80-40b7-11eb-88ae-421e7d5a71b1.gif"></p>
<p>Interactively, the function asks user to click one position on the heatmap. The function returns a <code>DataFrame</code> which contains the heatmap name, slice name and the row/column index of the matrix in that heatmap.</p>
<pre><code>## DataFrame with 1 row and 6 columns
##       heatmap                  slice row_slice column_slice row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;integer&gt;
## 1       mat_a mat_a_heatmap_body_1_2         1            2         9
##   column_index
##      &lt;integer&gt;
## 1            1</code></pre>
<p>The output means, the position user clicked corresponds to <code>mat[9, 1]</code> where <code>mat</code> is the original matrix that was sent to <code>Heatmap()</code>.</p>
<p>If the position clicked is not in any of the heatmap slices, the function returns <code>NULL</code>.</p>
<p>Similarly, the <code><a href="../reference/selectArea.html">selectArea()</a></code> function asks user to click two positions on the heatmap which defines an area.</p>
<p>
<img width="100%" style="border:1px solid grey;padding: 4px;" src="https://user-images.githubusercontent.com/449218/102546394-ddd74e80-40b7-11eb-990a-1b95bc52feca.gif"></p>
<p>Note since the selected area may overlap over multiple heatmaps and slices, the function returns a <code>DataFrame</code> with multiple rows which contains the heatmap names, slice names and the row/column indices in that heatmap. An example output can be found by clicking the button below.</p>
<pre><code>## DataFrame with 4 rows and 6 columns
##       heatmap                  slice row_slice column_slice     row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;IntegerList&gt;
## 1       mat_a mat_a_heatmap_body_1_2         1            2     7,5,2,...
## 2       mat_a mat_a_heatmap_body_2_2         2            2           6,3
## 3       mat_b mat_b_heatmap_body_1_1         1            1     7,5,2,...
## 4       mat_b mat_b_heatmap_body_2_1         2            1           6,3
##    column_index
##   &lt;IntegerList&gt;
## 1     2,4,1,...
## 2     2,4,1,...
## 3     1,2,3,...
## 4     1,2,3,...</code></pre>
<p>The columns <code>row_index</code> and <code>column_index</code> are stored in <code>IntegerList</code> format. To get the row indices in <em>e.g.</em> <code>mat_a_heatmap_body_1_2</code> (in the first row), user can use either one of the following command (assume the <code>DataFrame</code> object is called <code>df</code>):</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"row_index"</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span><span class="fl">1</span>, <span class="st">"row_index"</span><span class="op">]</span><span class="op">)</span>
<span class="va">df</span><span class="op">$</span><span class="va">row_index</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></code></pre></div>
<p>The rectangle and the points that mark the area can be turned off by setting <code>mark</code> argument to <code>FALSE</code>.</p>
</div>
<div id="on-non-interactive-graphics-devices" class="section level2">
<h2 class="hasAnchor">
<a href="#on-non-interactive-graphics-devices" class="anchor"></a>On non-interactive graphics devices</h2>
<p>It is also possible to use <code><a href="../reference/selectPosition.html">selectPosition()</a></code> and <code><a href="../reference/selectArea.html">selectArea()</a></code> on other non-interactive graphics devices, such as <code><a href="https://rdrr.io/r/grDevices/pdf.html">pdf()</a></code> or <code><a href="https://rdrr.io/r/grDevices/png.html">png()</a></code>. Now you cannot select the positions interactively, but instead you can specify <code>pos</code> argument in <code><a href="../reference/selectPosition.html">selectPosition()</a></code> and <code>pos1</code>/<code>pos2</code> in <code><a href="../reference/selectArea.html">selectArea()</a></code> to simulate clicks. The values for <code>pos</code>, <code>pos1</code> and <code>pos2</code> all should be a <code>unit</code> object of length two which correspond to the x and y coordinate of the positions.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pdf(...) or png(...) or other devices, because under this vignette generation, it is</span>
<span class="co"># already under a png() device, I don't need to call `png()` explictly.</span>
<span class="va">ht_list</span> <span class="op">=</span> <span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span><span class="op">)</span>
<span class="va">pos</span> <span class="op">=</span> <span class="fu"><a href="../reference/selectPosition.html">selectPosition</a></span><span class="op">(</span><span class="va">ht_list</span>, pos <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="implementation_files/figure-html/unnamed-chunk-8-1.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>##   Point: x = 3.0 cm, y = 3.0 cm (measured in the graphics device)
## 
## The heatmaps have been changed. Calculate new heatmap positions.
## Search in heatmap 'mat_a'
##   - row slice 1, column slice 1 [mat_a_heatmap_body_1_1]... overlap</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pos</span></code></pre></div>
<pre><code>## DataFrame with 1 row and 6 columns
##       heatmap                  slice row_slice column_slice row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;integer&gt;
## 1       mat_a mat_a_heatmap_body_1_1         1            1         8
##   column_index
##      &lt;integer&gt;
## 1            7</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remember to dev.off()</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># pdf(...) or png(...) or other devices</span>
<span class="va">ht_list</span> <span class="op">=</span> <span class="fu">draw</span><span class="op">(</span><span class="va">ht_list</span><span class="op">)</span>
<span class="va">pos</span> <span class="op">=</span> <span class="fu"><a href="../reference/selectArea.html">selectArea</a></span><span class="op">(</span><span class="va">ht_list</span>, pos1 <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span>, pos2 <span class="op">=</span> <span class="fu">unit</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="implementation_files/figure-html/unnamed-chunk-9-1.png" width="576" style="display: block; margin: auto;"></p>
<pre><code>##   Point 1: x = 3.0 cm, y = 3.0 cm (measured in the graphics device)
##   Point 2: x = 5.0 cm, y = 5.0 cm (measured in the graphics device)
## 
## Heatmap positions are already calculated, use the cached one.
## Search in heatmap 'mat_a'
##   - row slice 1, column slice 1 [mat_a_heatmap_body_1_1]... overlap
## Search in heatmap 'mat_a'
##   - row slice 1, column slice 2 [mat_a_heatmap_body_1_2]... overlap
## Search in heatmap 'mat_a'
##   - row slice 2, column slice 1 [mat_a_heatmap_body_2_1]... no overlap
## Search in heatmap 'mat_a'
##   - row slice 2, column slice 2 [mat_a_heatmap_body_2_2]... no overlap
## Search in heatmap 'mat_b'
##   - row slice 1, column slice 1 [mat_b_heatmap_body_1_1]... no overlap
## Search in heatmap 'mat_b'
##   - row slice 2, column slice 1 [mat_b_heatmap_body_2_1]... no overlap</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pos</span></code></pre></div>
<pre><code>## DataFrame with 2 rows and 6 columns
##       heatmap                  slice row_slice column_slice     row_index
##   &lt;character&gt;            &lt;character&gt; &lt;numeric&gt;    &lt;numeric&gt; &lt;IntegerList&gt;
## 1       mat_a mat_a_heatmap_body_1_1         1            1     7,5,2,...
## 2       mat_a mat_a_heatmap_body_1_2         1            2     7,5,2,...
##    column_index
##   &lt;IntegerList&gt;
## 1         7,3,5
## 2             6</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># remember to dev.off()</span></code></pre></div>
<p>Users do not need to use it directly with a non-interactive graphics device, however, it is very useful when developing a Shiny app where the plot is actually under a non-interactive graphics device. I will explain in the next section.</p>
</div>
<div id="shiny-app" class="section level2">
<h2 class="hasAnchor">
<a href="#shiny-app" class="anchor"></a>Shiny app</h2>
<p>With the three functions <code><a href="../reference/ht_pos_on_device.html">ht_pos_on_device()</a></code>, <code><a href="../reference/selectPosition.html">selectPosition()</a></code> and <code><a href="../reference/selectArea.html">selectArea()</a></code>, it is possible to implement Shiny apps for interactively working with heatmaps. Now the problem is how does the server side capture the positions that user clicked on the web page. Luckily, there is a solution for this. The output heatmap is normally put with <code>plotOutput()</code> and <code>plotOutput()</code> provides two actions <code>click</code> and <code>brush</code>. Then on the server side, it is possible to get the information of the positions that user clicked. The positions can be set to <code><a href="../reference/selectPosition.html">selectPosition()</a></code> and <code><a href="../reference/selectArea.html">selectArea()</a></code> via <code>pos</code> or <code>pos1</code>/<code>pos2</code> arguments to correspond to the matrices.</p>
<p><br><br><br><br><br><br><br><br></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Zuguang Gu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
